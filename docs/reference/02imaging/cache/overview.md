---
title: 缓存概述
---

# 缓存模块概述

`DicomTextureCache` 是一个纹理缓存管理器，它负责在三种切面（轴向、矢状、冠状）之间存储和淘汰 `Texture2D` 对象。该类采用分文件（partial class）形式实现，以保证代码模块化清晰，但对外暴露的接口统一。

## 作用

- **统一管理**: 提供一套接口用于将生成的纹理存入缓存、从缓存取出纹理以及设置缓存大小和窗宽窗位键。
- **资源复用**: 通过内部字典和 LRU（最近最少使用）列表复用已经生成的纹理，减少重复的计算和内存占用。
- **淘汰策略**: 当缓存超过数量或内存限制时，会按平衡策略淘汰分值最低的纹理。

## 主要字段（简述）

类内部为每个切面维护独立的缓存字典和 LRU 列表。还记录每个键的使用次数、最后访问时间以及纹理大小，以便于动态控制内存。缓存的大小和内存上限可以在运行时通过 `SetCacheSize()` 方法配置。

## 设计原则

- **线程安全**: 大部分方法内部都使用 `lock` 语句保护共享资源，确保在协程或多线程环境中安全。
- **最小依赖**: 缓存模块只负责存储和管理纹理，不关心纹理是如何生成的，也不直接操作 UI，这些由上层模块（如 `DicomTextureCreator` 和 `MPRTextureManager`）控制。