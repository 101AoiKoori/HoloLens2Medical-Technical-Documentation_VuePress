---
title: 像素数据提取原理
---
# 像素数据提取原理
## 功能思路

每个 DICOM 文件中存储了图像的像素矩阵。为了在不依赖图像转换器的情况下快速构建体积，加载器只提取每个数据集的第一帧像素数据，并将其存储为字节数组。该操作在数据流仍然有效的 `using` 块内完成，以避免访问已释放的资源。

## 原理拆解

1. **存在性检查**:首先检查数据集中是否包含 `PixelData` 标签；如果不存在或数据集为空则直接返回 `null`。
2. **读取像素帧**:创建 `DicomPixelData` 对象并调用 `GetFrame(0)` 获取第一帧。FellowOakDicom 支持多帧图像，但这里只需要一帧即可构建灰度体积。
3. **复制数据**:根据帧的大小分配字节数组，并使用 `Buffer.BlockCopy()` 将像素数据复制出来。这样可以避免对底层缓冲区的直接引用，提高安全性。
4. **异常处理**:整个过程用 try–catch 包裹，若发生异常则输出日志并返回 `null`。

## 使用建议

- DICOM 文件可能存储 8 位或 16 位像素，提取的字节数组长度会根据位深自动适配。读取完成后，创建 `Texture2D` 时需要根据位深选择合适的纹理格式。
- 如果需要采集多帧数据用于时间序列分析，可以扩展该方法在循环中提取所有帧。
