# 处理加载失败和异常

加载过程中可能出现索引不存在、文件无法读取、数据集无效或像素提取失败等问题。正确处理这些情况对于提升程序的稳定性至关重要。

## 订阅失败事件

请在启动加载前订阅 `OnLoadingFailed` 事件：

```csharp
loader.OnLoadingFailed.AddListener((string error) =>
{
    Debug.LogError($"加载失败: {error}");
    // 在 UI 中显示友好的提示
});
```

## 常见错误原因

1. **索引文件缺失**：未能在指定目录找到索引文件或索引解析结果为空，会在读取索引阶段失败【166205801724849†L50-L66】。
2. **文件无法读取**：路径错误或权限不足导致二进制数据为 `null`，将计入失败并记录日志【411489762169824†L40-L50】。
3. **无效的 DICOM 数据集**：数据集缺少像素、行列数为零或位深不是 8/16 位等情况会被判定为无效【782507737950471†L21-L30】。
4. **像素提取失败**：像素帧为空或异常，可能是压缩格式不支持或文件损坏【411489762169824†L69-L76】。
5. **切片尺寸不一致**：加载完成后如果发现切片尺寸不一致，会在最终验证时触发失败【782507737950471†L86-L98】。

## 调试建议

- 开启 `verboseLogging` 和 `logProgress` 以获取更详细的调试信息【201327181542954†L21-L41】。
- 订阅 `OnLogMessage` 事件，将所有日志打印到自定义窗口或文件，便于回溯问题。
- 确认所有 DICOM 文件来自同一序列，使用相同的分辨率和像素间距。

![失败处理示意图](./images/placeholder.png)
